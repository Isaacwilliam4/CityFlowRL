# Running the program

1. Create a conda env
```bash
conda create -name cityflowenv python=3.8
```
2. Run the following to build the c libraries 
```bash
python3 setup.py build_ext --inplace --debug
```
3. Install the city flow python package, in the root folder run
```bash
pip install .
```
4. Create a run file as specified in `mysim/run_sim.py`
5. Generate the `roadnet.json` and `flow.json` files by following the steps
outlined in `tools/generator/readme.md`
6. Create a config.json following the template in `examples/config.json` and
fill in the appropriate properties, easiest to just include the absolute path 
for the `dir` property
7. Run your `run_sim.py` program
8. Open `frontend/index.html` in a browser, I installed the Live Server extension
for vscode and used that
9. Pick the appropriate files generated by your `run_sim.py`
10. Press start, you should be able to see the simulation running


# Notes

When updating the c++ code in `src/` make sure to rebuild the code, the 
setup.py file can do this, just run

```bash
python3 setup.py build_ext --inplace
```

if you want to debug the c++ code with the python c++ debugger in vscode you 
need to compile the code with 

```bash
python3 setup.py build_ext --inplace --debug
```

And immedietly after, run

```
pip install .
```
in the root directory, this updates the references cityflow library to use your
new code.

The following launch.json is helpful for debugging, after installing the 
`python c++ debugger` extension copy the following to your launch.json file

```json
{
  // Use IntelliSense to learn about possible attributes.
  // Hover to view descriptions of existing attributes.
  // For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Build Roadnet and Flow files",
      "type": "debugpy",
      "request": "launch",
      "program": "${workspaceFolder}/tools/generator/generate_graph_scenario.py",
      "console": "integratedTerminal",
      "args": [
        "2", 
        "2",
        "--roadnetFile","${workspaceFolder}/mysim/roadnet.json", 
        "--flowFile", "${workspaceFolder}/mysim/flow.json"
      ]
    },
    {
      "name": "Run Simulation",
      "type": "debugpy",
      "request": "launch",
      "program": "${workspaceFolder}/mysim/run_sim.py",
      "console": "integratedTerminal"
    },
    {
      "name": "Python C++ Debug",
      "type": "pythoncpp",
      "request": "launch",
      "pythonLaunchName": "Run Simulation",
      "cppConfig": "default (gdb) Attach",
      "cppAttachName": "(gdb) Attach",
    }
  ]
}
```
## Docs

link to [cityflowdocs](https://cityflow.readthedocs.io/en/latest/introduction.html)

## TODO
- [ ] Update `src/` code in order to handle ideal roadnet json file 
- [ ] Update `generate_graph_scenario.py` and `generate_json_from_graph.py` to
produce the ideal roadnet file 